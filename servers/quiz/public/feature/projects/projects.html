<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quizzer</title>
    <style>
        .username, .password {
            width: 240px;
            display: flex;
        }
        .username > * , .password > * { flex: 1; margin-top: 4px}
        .password button {
            padding: 4px;
        }
        .sign-login > * {
            margin: 0 auto;
        }
        #error {
            background: red;
            color: whitesmoke;
        }
        h1 {text-align: center}
    </style>
</head>

<body>
    <div id="logged-in"></div>
    <div id="error"></div>
    <h1>Projects</h1>
    <div>
        <ul id="folders-ul">

        </ul>
    </div>
</body>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();
    socket.user = {};

    // Check browser support
    if (typeof(Storage) !== "undefined") {
        // Store
        localStorage.setItem("lastname", "Smith");
        // Retrieve
        document.getElementById("logged-in").innerHTML = localStorage.getItem("username");
    } else {
        document.getElementById("error").innerHTML = "Sorry, your browser does not support Web Storage...";
    }
    socket.on('connect', () => {
        console.log(socket.id);
    });

    socket.on('server-sent-data-folders', (folders) => {
        console.log('server sent folders', folders);
        const foldersUl = document.querySelector('#folders-ul');
        foldersUl.innerHTML = '';
        folders.forEach( folder => {
            const a = document.createElement('a');
            const li = document.createElement('li');
            a.appendChild(document.createTextNode(folder));
            li.appendChild(a);
            a.setAttribute('href', '');
            foldersUl.appendChild(li);
            // action
            a.addEventListener('click', function () {
                socket.emit('request-server-for-redirect', 'projects/' + folder)
            })
        });
    });

    socket.on('client-should-redirect', (page) => {
        console.log('server is letting us know we need to redirect');
        console.log('server event', window.location.href);
        const redirect = window.location.href.split('/');
        redirect[redirect.length -1 ] = page;
        console.log('redirect', redirect.join('/'));
        window.location.href = redirect.join('/');
    });

    socket.on('error-message', (error) => {
        console.log('error');
        document.querySelector('#error').innerHTML = error;
    });

    socket.emit('request-server-for-folders', '');
    setInterval(() => {
        socket.emit('request-server-for-folders', '');
    }, 5000)
</script>
</html>